version: "3.3"

services:
  vscode:
    image: codercom/code-server
    container_name: vscode-server
    restart: always
    environment:
      - PASSWORD=password  # Replace with your desired password
    volumes:
      - "./persist/code:/home/coder/project"
    labels:
      - "traefik.enable=true"
      # HTTP router
      - "traefik.http.routers.vscode.rule=Host(`vscode.${MAIN_DOMAIN}`)"
      - "traefik.http.routers.vscode.entrypoints=web"
      - "traefik.http.services.vscode.loadbalancer.server.port=8080"
      # HTTPS router
      - "traefik.http.routers.vscode-secure.rule=Host(`vscode.${MAIN_DOMAIN}`)"
      - "traefik.http.routers.vscode-secure.entrypoints=websecure"
      - "traefik.http.routers.vscode-secure.tls=true"
      - "traefik.http.services.vscode-secure.loadbalancer.server.port=8080"
#      # Middleware for redirecting HTTP to HTTPS
#      - "traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https"
    networks:
      - backboneNetwork


networks:
  backboneNetwork:
    external: true
